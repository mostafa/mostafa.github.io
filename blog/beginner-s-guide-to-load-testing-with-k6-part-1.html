<!DOCTYPE html>
<html>

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Beginner’s Guide to Load Testing with k6</title>
    <meta name="description" content="Update: This article is part of a series on load testing. I will try to regularly publish related topics in this series. I won’t repeat this table of content...">

    
    
    <link rel="stylesheet" href="https://mostafa.dev/assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet">
    <link rel="canonical" href="https://mostafa.dev/blog/beginner-s-guide-to-load-testing-with-k6-part-1">
    <link rel="alternate" type="application/rss+xml" title="Mostafa's personal blog" href="https://mostafa.dev/feed.xml">

    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Beginner’s Guide to Load Testing with k6 | Mostafa’s personal blog</title>
<meta name="generator" content="Jekyll v4.0.1">
<meta property="og:title" content="Beginner’s Guide to Load Testing with k6">
<meta property="og:locale" content="en_US">
<meta name="description" content="Part 1 — The Prelude">
<meta property="og:description" content="Part 1 — The Prelude">
<link rel="canonical" href="https://mostafa.dev/blog/beginner-s-guide-to-load-testing-with-k6-part-1">
<meta property="og:url" content="https://mostafa.dev/blog/beginner-s-guide-to-load-testing-with-k6-part-1">
<meta property="og:site_name" content="Mostafa’s personal blog">
<meta property="og:image" content="https://mostafa.dev/img/1*pOH0TCmxUt-jpDOpGPHL8A.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-06-17T00:00:00+02:00">
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://mostafa.dev/blog/beginner-s-guide-to-load-testing-with-k6-part-1","headline":"Beginner’s Guide to Load Testing with k6","dateModified":"2019-06-17T00:00:00+02:00","datePublished":"2019-06-17T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mostafa.dev/blog/beginner-s-guide-to-load-testing-with-k6-part-1"},"image":"https://mostafa.dev/img/1*pOH0TCmxUt-jpDOpGPHL8A.png","description":"Part 1 — The Prelude","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <style>
        body {
            font-family: 'Ubuntu', sans-serif;
            font-size: 16px;
            line-height: 2;
            color: #181818;
            background-color: #fff;
        }

        .subtitle {
            color: rgba(0, 0, 0, 0.54) !important;
        }
    </style>
</head>

  <body>

    <header class="border-bottom-thick px-2 clearfix">
  <div class="left sm-width-full py-1 mt-1 mt-lg-0">
    <a class="align-middle link-primary text-accent" href="/">
      Mostafa's personal blog
    </a>
  </div>
  <div class="right sm-width-full">
    <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
      
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/about/">
            About
          </a>
        </li>
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</header>


    <div>
      <article class="container px-2 mx-auto mb4" itemscope itemtype="http://schema.org/BlogPosting">
    <h1 class="h1 col-9 sm-width-full mt-3 mb-0 pb-0 inline-block" itemprop="name headline">Beginner’s Guide to Load Testing with k6</h1>
    
        <h3 class="h3 col-9 sm-width-full mb-0 mt-0 inline-block subtitle" itemprop="name headline">Part 1 — The Prelude
        </h3>
    
    
        <img class="col-12" src="/img/1*pOH0TCmxUt-jpDOpGPHL8A.png">
    
    <div class="col-3 sm-width-full mt-1 border-top-thin ">
        <p class="mb-3 py-2 h4">
            <time datetime="2019-06-17T00:00:00+02:00" itemprop="datePublished">Jun 17, 2019</time>
        </p>
    </div>

    <div class="prose" itemprop="articleBody">
        <p><em>Update: This article is part of a series on load testing. I will try to regularly publish related topics in this series. I won’t repeat this table of contents on every single article, so please check this very first one to get new updates. Also I will try to link articles together, so that you can easily follow the next one in the series. Ever since, these has been published:</em></p>

<blockquote>
  <p><a href="https://medium.com/swlh/beginners-guide-to-load-testing-with-k6-85ec614d2f0d">Part 1 — The Prelude</a>
<a href="https://medium.com/swlh/beginners-guide-to-load-testing-with-k6-73d55ee23723">Part 2 — Performance Goals and k6 Metrics</a>
<a href="https://medium.com/swlh/beginners-guide-to-load-testing-with-k6-ff155885b6db">Part 3 — How to Write &amp; Run a Load Test Using k6</a>Let’s start with some questions:</p>
</blockquote>

<ul>
  <li>Have you ever thought about ways to find out if your infrastructure setup could stand under high loads of users?</li>
  <li>Have you ever been able to run a load test without dealing with so many configurations and steep learning curve of current testing tools?</li>
  <li>Have you ever thought about ways to script your way through testing, either for load/performance or otherwise?</li>
  <li>Have you ever thought that performance testing can be simplified and be included as part of your CI/CD process?
You are not alone in that. I remember days when I was the lead developer of a team working on developing an API to serve our ever-increasing set of Apps with many micro-services like content- and user-management, billing, analytics and the like. At that time, we used to use the latest best practices in software engineering in source control and CI/CD processes. We have set up our CI/CD process using docker and hosted GitLab and used GitLab CI to deal with CI process. After a while of testing and code-push, we have decided to go with an alpha-stage API that can answer our needs with a new App we used to develop.</li>
</ul>

<p>After a while of development, testing and improvement, we decided to test our API under load to see if it can hold up to the promises. Since we have seen that after 200,000 users subscribing and 60,000 of them using one of our other Apps, there is an slow-down on the request/response flow to the other API, which roughly had the same setup.</p>

<p>So, in order to not miss the opportunity of (load) testing before customers coming in, we decided to investigate ways to load test our API. After our investigations into Locust, Apache JMeter and the like, we decided to go with Apache JMeter, which was (and still is) the tool of the trade. We thought it would be a good candidate for this purpose. It took us almost three days to be able to learn and execute simple load tests with the GUI version. We were able to produce load test from one server and analyze the results. The results were good, because it gave us a bit more insight into what we should expect from our API, in terms of number of concurrent users and our API’s response time under load.</p>

<p>But later we didn’t use the tool, since there was no clear way to integrate it into our CI/CD process at that time, and we didn’t have enough time to learn and use it. We wanted something more developer-friendly, more integrable to our workflow, and easier to learn. Nowadays, it has been improved very much and it integrates with CI/CD pipelines easily.</p>

<p>Now, I am working for a company, <a href="https://loadimpact.com/">Load Impact</a>, which deals with load and performance testing as their core business. They have a FOSS, easily scriptable tool (JavaScript), called <a href="https://k6.io/">k6</a>, which can be used for load testing. They also offer a cloud service on top of <em>the same exact tool</em>, for provisioning and running the tests, from different regions of the world (<a href="https://loadimpact.com/cloud-execution/">Cloud Execution</a>), and it finally give you a nice dashboard (<a href="https://loadimpact.com/insights/">Insights</a>) with analyzed results of the tests with shiny charts. It also has good <a href="https://loadimpact.com/integrations/">integrations</a> with CI/CD tools and platforms.</p>

<p><img src="/img/1*DgpDE9wBwxVKtmTk_BLnzA.png" alt=""><strong>Left</strong>: load test script written in JavaScript, <strong>Right</strong>: Cloud service of Load Impact (Insights), <strong>Credits</strong>: <a href="https://loadimpact.com/">https://loadimpact.com/</a>Enough said! Let’s dive deep into what load testing is and how we can use k6 for doing load testing on our infrastructure. I will try to write more about the cloud service in the future, too.</p>

<h4 id="what-is-loadperformance-testing">What is Load/Performance Testing?</h4>

<p>Performance testing is a subset of performance engineering in computer science practice which deals with quality assurance of software by putting pressure and workload, either manually or automatically, on the software to see how it behaves and to make sure it is responsive and stable enough under that load. It’s all about expectations. For example, you expect your API or website to serve 10K users simultaneously, but when you put pressure on it, it quickly becomes evident that your calculations differs from the reality and the reverse proves to be the case. Then you should analyze the weak points in your design or setup to see how you can benefit from high load.</p>

<p>There are many types of tests catered for different purposes in performance testing (Source: <a href="https://en.wikipedia.org/wiki/Software_performance_testing">https://en.wikipedia.org/wiki/Software_performance_testing</a>):</p>

<ul>
  <li>
<strong>Load testing</strong>: basically, putting load on the system to see how it behaves.</li>
  <li>
<strong>Stress testing</strong>: load testing to find the maximum amount of load the system can handle.</li>
  <li>
<strong>Soak testing</strong>: load testing a system continuously and monitoring for memory leaks and behavior of the system.</li>
  <li>
<strong>Spike testing</strong>: load testing with sudden increase or decrease of the load.</li>
  <li>
<strong>Breakpoint testing</strong>: like stress testing, but incremental load is put on the system over time to see how it behaves.</li>
  <li>
<strong>Configuration testing</strong>: changing configuration to see how the system behaves under different configurations, under load.</li>
  <li>
<strong>Isolation testing</strong>: Isolating a fault domain and repeating the test to confirm the failure.</li>
  <li>
<strong>Internet testing</strong>: global load testing for big companies to see how to system behaves from different regions.
The most common purpose of performance testing is to find out how reliable, stable, performant and responsive the system is. Metrics like throughput and response time is a good measure of such a system.</li>
</ul>

<h4 id="k6-scripting-and-running-load-tests-and-interpreting-the-results">k6: Scripting and Running Load Tests and Interpreting The Results</h4>

<p>k6 is a Free/Open-Source tool, written in Go, which can ingest tests written in JavaScript (ES5.1+) and turn them into requests to load test your website or API.</p>

<p>The easiest possible way to use k6 is to install it on your machine using a <a href="https://docs.k6.io/docs/installation">official prebuilt binary version</a>. k6 supports Microsoft Windows with an <em>MSI</em> installer, GNU/Linux with an <em>APT</em> repository and Apple macOS using <em>brew</em>.</p>

<p>There is also <a href="https://hub.docker.com/r/loadimpact/k6/">a official docker image</a>. It is not recommended for beginners to build from source, but you always have the option to do that.</p>

<p>You can then run your installed k6 command with the following script:</p>

<p>A sample test script for k6Once you have saved this script somewhere accessible to k6, naming it script.js or your own desired file name, you can run it with 10 *virtual users *(VU) and over a period of 30 seconds, as follows:</p>

<p>k6 run -u 10 -d 30s script.jsIt basically runs k6 on your machine using 10 virtual users over the course of 30 seconds, and it checks to see if the test URL returns <em>200 (OK)</em> in all tests.</p>

<p>The output of running this command would be as below. I recommend you to have a look at it to better understand different metrics, checks and other key-values. This output will be thoroughly explained in the next articles.</p>

<p>By interpreting the current output, you can see that the script is <em>locally executed *for the *duration of 30 seconds *and spawned *10 separate virtual users (vus)</em> to test the URL. You can also see the highlighted green checked item, “<em>is status 200</em>”, that signifies that our <em>check has passed for 100% of the cases</em>, meaning all cases.</p>

<p>The total data sent and received in 2775 requests is also present. For each HTTP requests, there is a <em>http_req_** metric (key) with 5 different values, each corresponding to the *average, minimum, median, maximum, 90th percentile and 95th percentile</em> of all the requests.</p>

<p><img src="/img/1*aSlAqLfzEWVTy4j49n5QYg.png" alt="">Terminal output of the sample test script for k6This was a very short introduction to performance/load testing and the k6 tool. I will try to write more advanced load testing articles to show you how to load test your website and/or API.</p>

<p>This series will continue with more in-depth performance/load testing articles assuming the readers don’t have previous experience on this topic.</p>

<p><a href="https://medium.com/swlh/beginners-guide-to-load-testing-with-k6-73d55ee23723">In the next article in this series</a>, I will try to talk about performance goals and k6 metrics, which are the building blocks of load testing.</p>

<p>As always, I do really appreciate your suggestions, comments and inputs on this. And I would like to thank Pepe Cano and Robin Gustafsson for their valuable comments and suggestions on this article and the series.</p>

<p>Cover image credits: <a href="https://grafana.com/dashboards/2587">https://grafana.com/dashboards/2587</a></p>

    </div>

</article>

<div class="container mx-auto px-2 py-2 clearfix">
    <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline border-top-thin py-1 block" href="https://mostafa.dev/blog/secure-code-review-and-penetration-testing-of-node-js-and-javascript-apps">
      <span class="h5 bold text-accent">Previous</span>
      <p class="bold h3 link-primary mb-1">Secure Code Review and Penetration Testing of Node.js and JavaScript Apps</p>
      <p>Security is an illusion and being secure is a relative matter. This means you should always have an eye on...</p>
    </a>
  </div>
  
  
  <div class="col-4 sm-width-full left mt-3">
    <a class="no-underline border-top-thin py-1 block" href="https://mostafa.dev/blog/beginner-s-guide-to-load-testing-with-k6-part-2">
      <span class="h5 bold text-accent">Next</span>
      <p class="bold h3 link-primary mb-1">Beginner’s Guide to Load Testing with k6</p>
      <p>Performance testing is an umbrella term for a group of tests that encompasses many types of tests, as discussed in...</p>
    </a>
  </div>


</div>
    </div>

    <div class="border-top-thin clearfix mt-2 mt-lg-4">
  <div class="container mx-auto px-2">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/mostafa">mostafa</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="Mostafa's personal blog">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/mostafa/" data-icon="octicon-star" data-count-href="mostafa//stargazers" data-count-api="/repos/mostafa/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star mostafa/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>

</html>
