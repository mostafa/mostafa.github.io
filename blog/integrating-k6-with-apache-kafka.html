<!DOCTYPE html>
<html>

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Integrating k6 with Apache Kafka</title>
    <meta name="description" content="Undoubtedly, Apache Kafka is one of the most prominent pieces of software existing in today’s distributed architectures, from cloud-providers supporting it t...">

    
    
    <link rel="stylesheet" href="https://mostafa.dev/assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet">
    <link rel="canonical" href="https://mostafa.dev/blog/integrating-k6-with-apache-kafka">
    <link rel="alternate" type="application/rss+xml" title="Mostafa's personal blog" href="https://mostafa.dev/feed.xml">

    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Integrating k6 with Apache Kafka | Mostafa’s personal blog</title>
<meta name="generator" content="Jekyll v4.0.1">
<meta property="og:title" content="Integrating k6 with Apache Kafka">
<meta property="og:locale" content="en_US">
<meta name="description" content="How to send k6 output to Apache Kafka?">
<meta property="og:description" content="How to send k6 output to Apache Kafka?">
<link rel="canonical" href="https://mostafa.dev/blog/integrating-k6-with-apache-kafka">
<meta property="og:url" content="https://mostafa.dev/blog/integrating-k6-with-apache-kafka">
<meta property="og:site_name" content="Mostafa’s personal blog">
<meta property="og:image" content="https://mostafa.dev/img/0*TDOUgQUzVFGShAHO.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-11-22T00:00:00+01:00">
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://mostafa.dev/blog/integrating-k6-with-apache-kafka","headline":"Integrating k6 with Apache Kafka","dateModified":"2019-11-22T00:00:00+01:00","datePublished":"2019-11-22T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mostafa.dev/blog/integrating-k6-with-apache-kafka"},"image":"https://mostafa.dev/img/0*TDOUgQUzVFGShAHO.png","description":"How to send k6 output to Apache Kafka?","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <style>
        body {
            font-family: 'Ubuntu', sans-serif;
            font-size: 16px;
            line-height: 2;
            color: #181818;
            background-color: #fff;
        }

        .subtitle {
            color: rgba(0, 0, 0, 0.54) !important;
        }
    </style>
</head>

  <body>

    <header class="border-bottom-thick px-2 clearfix">
  <div class="left sm-width-full py-1 mt-1 mt-lg-0">
    <a class="align-middle link-primary text-accent" href="/">
      Mostafa's personal blog
    </a>
  </div>
  <div class="right sm-width-full">
    <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
      
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/about/">
            About
          </a>
        </li>
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</header>


    <div>
      <article class="container px-2 mx-auto mb4" itemscope itemtype="http://schema.org/BlogPosting">
    <h1 class="h1 col-9 sm-width-full mt-3 mb-0 pb-0 inline-block" itemprop="name headline">Integrating k6 with Apache Kafka</h1>
    
        <h3 class="h3 col-9 sm-width-full mb-0 mt-0 inline-block subtitle" itemprop="name headline">How to send k6 output to Apache Kafka?
        </h3>
    
    
        <img class="col-12" src="/img/0*TDOUgQUzVFGShAHO.png">
    
    <div class="col-3 sm-width-full mt-1 border-top-thin ">
        <p class="mb-3 py-2 h4">
            <time datetime="2019-11-22T00:00:00+01:00" itemprop="datePublished">Nov 22, 2019</time>
        </p>
    </div>

    <div class="prose" itemprop="articleBody">
        <p>Undoubtedly, <a href="https://kafka.apache.org/">Apache Kafka</a> is one of the most prominent pieces of software existing in today’s distributed architectures, from cloud-providers supporting it to on-premise setups. It can be used to store and process millions of messages per second, so it makes it a perfect fit for distributed real-time data processing solutions. Although it provides very advanced features like stream-processing and horizontal scalability, it is very easy to use: you just have to send your messages to it (produce) and later pick them up (consume) for further processing. It has all the features you need from a modern distributed data store: communication interface, persistence, scalability, streaming and management. Once developed at LinkedIn for data processing, later donated to the Apache Software Foundation. I do highly recommend you to have a look at its <a href="https://kafka.apache.org/documentation/">documentation</a>.</p>

<p><a href="https://k6.io/">k6</a> is a free and open-source load testing tool built with unit-testing in mind, but for performance. It can produce hundreds of messages per second, as a result of testing a system or platform. These messages can be sent to a number of different destinations, like a JSON file or Apache Kafka, which works out of the box with zero dependency, other than the Apache Kafka setup itself.</p>

<p>To be able to send messages from k6 to Apache Kafka, we’d go with <a href="https://kafka.apache.org/documentation/#quickstart">a very simple setup</a>, with only one instance. In our scenario, k6 would act as a simple producer of JSON messages and we’ll try to consume message on terminal, using the built-in simple kafka consumer. Here I will use the official binary provided by Apache and would leave the docker setup up to you to try. To give you a clue, using Lenses.io’s <a href="https://github.com/lensesio/fast-data-dev">fast-data-dev</a>, you can have a complete Docker environment with Kafka, ZooKeeper, Schema Registry, Kafka-Connect, Landoop Tools and more than 20 connectors in an easy to use package.</p>

<p>Since we’re using the binary package, no special installation is needed, and you can directly invoke the binary from the command line. I have used <a href="https://www.debian.org/">Debian GNU/Linux</a> 10.2 to run these commands. Simply follow the instructions below:</p>

<h3 id="1-download-and-extract-apache-kafka-platform-binaries">1. Download and extract Apache Kafka platform binaries</h3>

<p>The current version as of this writing is 2.3.0, but you can choose your own desired version.</p>

<p>$ <strong>wget **<a href="http://apache.mirrors.spacedump.net/kafka/2.3.0/kafka_2.12-2.3.0.tgz">**http://apache.mirrors.spacedump.net/kafka/2.3.0/kafka_2.12-2.3.0.tgz**</a><br>
$ **tar xvf kafka_2.12-2.3.0.tgz</strong><br>
$ <strong>cd kafka_2.12-2.3.0</strong>### 2. Start Apache ZooKeeper and Kafka</p>

<p>As you can see, when you start the ZooKeeper, it will start listening on all interfaces (0.0.0.0) on port <strong>2181</strong>.</p>

<p>$ <strong>bin/zookeeper-server-start.sh config/zookeeper.properties</strong>Now start Kafka server in a new terminal. It will connect to your local ZooKeeper instance on port 2181 and will start listening for new connections on port <strong>9092</strong>.</p>

<p>$ <strong>bin/kafka-server-start.sh config/server.properties</strong><br>
[2019-11-15 12:43:54,672] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)<br>
…<br>
[2019-11-15 12:43:55,366] INFO Awaiting socket connections on 0.0.0.0:9092. (kafka.network.Acceptor)<br>
…<br>
[2019-11-15 12:43:55,666] INFO [KafkaServer id=0] started (kafka.server.KafkaServer)### 3. Create a topic to send k6 data to</p>

<p>On another terminal, create a topic, for example <em>k6-output</em>, to receive k6 messages on. This topic would be a single partition topic with no replication.</p>

<p>$ <strong>bin/kafka-topics.sh –create –bootstrap-server localhost:9092 –replication-factor 1 –partitions 1 –topic k6-output</strong>### 4. Start k6 with Kafka output</p>

<p>Using the following script in a file named <em>scenario.js</em>, we’ll start k6 to send its output to Kafka:</p>

<p>$ <strong>k6 run –logformat=raw –out kafka=brokers=localhost:9092,topic=k6-output,format=json scenario.js</strong>### 5. Consume message on a terminal</p>

<p>To view message of k6 output on your terminal, use the following built-in consumer:</p>

<p>$ <strong>bin/kafka-console-consumer.sh –bootstrap-server localhost:9092 –topic k6-output</strong>As you can see, we’ve sent our message with JSON format to Kafka, so you can write a simple JSON consumer in your own desired programming language (e.g. Python) and start consuming and using the data provided by k6 to Kafka. There are other possibilities, like using platforms that can import or consume data from Apache Kafka, like <a href="https://spark.apache.org/">Apache Spark</a> or Kafka Connect from <a href="https://www.confluent.io/product/confluent-platform/">Confluent Platform</a>, to name a few.</p>

<p>You can also use visualization platforms that has support for Kafka as input. I recommend reading the following articles about it:</p>

<p><a href="https://www.elastic.co/blog/just-enough-kafka-for-the-elastic-stack-part1"><strong>Just Enough Kafka for the Elastic Stack, Part 1</strong></a></p>

<p><a href="https://www.elastic.co/blog/just-enough-kafka-for-the-elastic-stack-part2"><strong>Just Enough Kafka for the Elastic Stack, Part 2</strong></a></p>

<p><a href="https://grafana.com/blog/2019/07/22/guest-blog-post-how-the-k6-load-testing-tool-is-leveraging-grafana/"><strong>Guest Blog Post: How the k6 Load Testing Tool Is Leveraging Grafana</strong></a></p>

<p>I hope you’ve found this article helpful and were able to send your k6 output to Apache Kafka, an industry-proven technology.</p>

<p>If you have any suggestions or comments, I really like to hear from you.</p>

<p><em>Originally published at <a href="https://blog.loadimpact.com/integrating-k6-with-apache-kafka">https://blog.loadimpact.com</a>.</em></p>

    </div>

</article>

<div class="container mx-auto px-2 py-2 clearfix">
    <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline border-top-thin py-1 block" href="https://mostafa.dev/blog/migration-of-old-projects-to-python-3">
      <span class="h5 bold text-accent">Previous</span>
      <p class="bold h3 link-primary mb-1">Migration of Old Projects to Python 3</p>
      <p>A while ago I’ve self-assigned the daunting task of migrating an ancient API project written in Python 2.7 and Django...</p>
    </a>
  </div>
  
  
  <div class="col-4 sm-width-full left mt-3">
    <a class="no-underline border-top-thin py-1 block" href="https://mostafa.dev/blog/api-backend-security">
      <span class="h5 bold text-accent">Next</span>
      <p class="bold h3 link-primary mb-1">API &amp; Backend Security</p>
      <p>In my [previous article](https://medium.com/swlh/secure-code-review-and-penetration-testing-of-node-js-and-javascript-apps-41485b1a9518) about secure code review and penetration testing of Node.js and JavaScript apps, I tried to give...</p>
    </a>
  </div>


</div>
    </div>

    <div class="border-top-thin clearfix mt-2 mt-lg-4">
  <div class="container mx-auto px-2">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/mostafa">mostafa</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="Mostafa's personal blog">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/mostafa/" data-icon="octicon-star" data-count-href="mostafa//stargazers" data-count-api="/repos/mostafa/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star mostafa/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>

</html>
